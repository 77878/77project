<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>獵人戰情室 V7.8</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #0b1121; color: #f1f5f9; font-family: system-ui, sans-serif; }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; }
        .glow-text-emerald { text-shadow: 0 0 10px rgba(16, 185, 129, 0.5); }
        .glow-text-rose { text-shadow: 0 0 10px rgba(244, 63, 94, 0.5); }
        input[type="number"]::-webkit-inner-spin-button { display: none; }
        input:focus { outline: none; border-color: #3b82f6 !important; }
    </style>
</head>
<body class="p-4 pb-10">
    <div class="max-w-md mx-auto space-y-5">
        
        <div class="flex justify-between items-center px-2">
            <h1 class="text-3xl font-black italic tracking-tighter text-white uppercase">Hunter V7.8</h1>
            <div class="text-right">
                <p class="text-[10px] text-slate-500 font-bold uppercase">Dynamic Monitoring</p>
                <div id="m_rate_badge" class="text-[9px] px-2 py-0.5 rounded-full font-black bg-emerald-500/20 text-emerald-400">SAFE</div>
            </div>
        </div>

        <div class="glass-card p-6 shadow-2xl relative">
            <div class="flex justify-between items-center mb-6">
                <div class="w-28 h-28 relative">
                    <canvas id="assetChart"></canvas>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <p class="text-[8px] text-slate-500 font-bold">戰術總額</p>
                        <p id="tactical_total" class="text-[11px] font-black text-white">$---</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-[10px] text-slate-500 font-bold uppercase">聯防維持率</p>
                    <p id="m_rate" class="text-5xl font-black italic leading-none glow-text-emerald text-emerald-400">---%</p>
                    <p class="text-[9px] text-slate-400 font-bold mt-2">擔保品市值: <span id="collateral_val" class="text-white">$---</span></p>
                </div>
            </div>
            <div id="chart_legend" class="grid grid-cols-3 gap-2 border-t border-white/5 pt-4"></div>
        </div>

        <div class="glass-card p-5">
            <h3 class="text-xs font-black text-blue-400 uppercase tracking-widest mb-4 text-center">擔保品壓力測試 (現有 + 00662)</h3>
            <div class="overflow-hidden rounded-xl border border-white/5 bg-slate-900/50">
                <table class="w-full text-center text-[11px]">
                    <thead class="bg-white/5 text-slate-500 uppercase font-bold">
                        <tr>
                            <th class="py-2">擔保品跌幅</th>
                            <th>預估市值</th>
                            <th>預估維持率</th>
                        </tr>
                    </thead>
                    <tbody id="stress_table" class="font-mono">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
            <div id="instruction_card" class="glass-card p-4 border-l-4 border-amber-500">
                <div class="flex items-center gap-2 mb-2">
                    <input type="checkbox" id="paid_toggle" onchange="refreshEngine()" class="w-3 h-3 accent-emerald-500">
                    <label class="text-[10px] font-black text-slate-400">2.5W 已入金</label>
                </div>
                <div id="ins_body" class="text-[10px] font-bold text-white"></div>
            </div>
            <div class="glass-card p-4 border-l-4 border-emerald-500">
                <p class="text-[10px] font-black text-slate-400 mb-2 uppercase">額外獎金分配</p>
                <input type="number" id="bonus_input" oninput="refreshEngine()" class="w-full bg-slate-900 border border-white/10 rounded px-2 py-1 text-xs text-emerald-400" placeholder="輸入金額...">
                <div id="bonus_body" class="text-[9px] mt-2 text-slate-400 leading-tight"></div>
            </div>
        </div>

        <div class="glass-card p-5 space-y-4">
            <div class="flex justify-between items-center">
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest italic">戰術數據修正 (即時連動)</h3>
            </div>
            <div class="space-y-3">
                <div class="bg-blue-500/10 p-3 rounded-xl border border-blue-500/20">
                    <label class="text-[9px] text-blue-400 font-black uppercase block mb-1">當前質押借款金額</label>
                    <input type="number" id="v_loan" value="300000" oninput="refreshEngine()" class="w-full bg-transparent text-xl font-black font-mono text-white">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-slate-800/50 p-2 rounded-xl border border-white/5">
                        <label class="text-[9px] text-slate-500 font-bold block">現有資產</label>
                        <input type="number" id="v_main" value="660000" oninput="refreshEngine()" class="w-full bg-transparent text-sm font-mono font-bold">
                    </div>
                    <div class="bg-slate-800/50 p-2 rounded-xl border border-white/5 text-sky-400">
                        <label class="text-[9px] text-slate-500 font-bold block">00662</label>
                        <input type="number" id="v_662" value="200000" oninput="refreshEngine()" class="w-full bg-transparent text-sm font-mono font-bold">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-slate-800/50 p-2 rounded-xl border border-white/5 text-indigo-400">
                        <label class="text-[9px] text-slate-500 font-bold block">00631L</label>
                        <input type="number" id="v_631" value="200000" oninput="refreshEngine()" class="w-full bg-transparent text-sm font-mono font-bold">
                    </div>
                    <div class="bg-slate-800/50 p-2 rounded-xl border border-white/5 text-emerald-400">
                        <label class="text-[9px] text-slate-500 font-bold block">類現金</label>
                        <input type="number" id="v_cash" value="185000" oninput="refreshEngine()" class="w-full bg-transparent text-sm font-mono font-bold">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let myChart;

        function refreshEngine() {
            const vLoan = parseFloat(document.getElementById('v_loan').value) || 1;
            const vMain = parseFloat(document.getElementById('v_main').value) || 0;
            const v662 = parseFloat(document.getElementById('v_662').value) || 0;
            const v631 = parseFloat(document.getElementById('v_631').value) || 0;
            const vCash = parseFloat(document.getElementById('v_cash').value) || 0;
            const isPaid = document.getElementById('paid_toggle').checked;
            const bonus = parseFloat(document.getElementById('bonus_input').value) || 0;

            const collateral = vMain + v662;
            const mRate = (collateral / vLoan) * 100;
            const tacticalTotal = v662 + v631 + vCash;

            // 更新維持率
            const mRateEl = document.getElementById('m_rate');
            mRateEl.innerText = Math.round(mRate) + '%';
            mRateEl.className = `text-5xl font-black italic leading-none ${mRate < 170 ? 'text-rose-500 glow-text-rose' : (mRate < 240 ? 'text-amber-500 glow-text-amber' : 'text-emerald-400 glow-text-emerald')}`;
            document.getElementById('m_rate_badge').innerText = mRate < 170 ? 'DANGER' : (mRate < 240 ? 'WARNING' : 'SAFE');
            document.getElementById('collateral_val').innerText = `$${collateral.toLocaleString()}`;
            document.getElementById('tactical_total').innerText = `$${(tacticalTotal/10000).toFixed(1)}萬`;

            // 更新圓餅圖 (只計 4:4:2)
            updateChart(v662, v631, vCash);

            // 更新指令區
            const insBody = document.getElementById('ins_body');
            if(!isPaid) {
                insBody.innerHTML = `本月補給建議：<br><span class="text-sky-400">662: $10,000</span><br><span class="text-indigo-400">631L: $10,000</span><br><span class="text-emerald-400">類現金: $5,000</span>`;
            } else {
                insBody.innerHTML = `<span class="text-emerald-400">✓ 補給已完成</span><br><span class="text-[8px] text-slate-500">待命：00662 跌 20% 加碼</span>`;
            }

            // 更新獎金分配
            const bonusBody = document.getElementById('bonus_body');
            if(bonus > 0) {
                bonusBody.innerHTML = `662: $${Math.round(bonus*0.4).toLocaleString()}<br>631L: $${Math.round(bonus*0.4).toLocaleString()}<br>類現金: $${Math.round(bonus*0.2).toLocaleString()}`;
            } else { bonusBody.innerHTML = ""; }

            // 壓力測試矩陣 (回歸經典)
            const stressTable = document.getElementById('stress_table');
            const drops = [0.1, 0.2, 0.3, 0.4, 0.5];
            let tableHTML = "";
            drops.forEach(d => {
                const sCollateral = collateral * (1 - d);
                const sRate = (sCollateral / vLoan) * 100;
                const rowClass = sRate < 166 ? 'text-rose-500 font-bold bg-rose-500/10' : (sRate < 240 ? 'text-amber-500' : 'text-slate-300');
                tableHTML += `<tr class="${rowClass} border-b border-white/5">
                    <td class="py-2">-${Math.round(d*100)}%</td>
                    <td>$${Math.round(sCollateral).toLocaleString()}</td>
                    <td>${Math.round(sRate)}%</td>
                </tr>`;
            });
            stressTable.innerHTML = tableHTML;
        }

        function updateChart(v1, v2, v3) {
            const ctx = document.getElementById('assetChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [v1, v2, v3],
                        backgroundColor: ['#38bdf8', '#818cf8', '#10b981'],
                        borderWidth: 0
                    }]
                },
                options: { cutout: '80%', plugins: { legend: { display: false } } }
            });
            const t = v1 + v2 + v3;
            document.getElementById('chart_legend').innerHTML = `
                <div class="text-center text-[10px] text-sky-400 font-black">${Math.round(v1/t*100)}%<br><span class="text-[8px] text-slate-600 font-bold uppercase">662</span></div>
                <div class="text-center text-[10px] text-indigo-400 font-black">${Math.round(v2/t*100)}%<br><span class="text-[8px] text-slate-600 font-bold uppercase">631L</span></div>
                <div class="text-center text-[10px] text-emerald-400 font-black">${Math.round(v3/t*100)}%<br><span class="text-[8px] text-slate-600 font-bold uppercase">類現金</span></div>
            `;
        }

        window.onload = refreshEngine;
    </script>
</body>
</html>
